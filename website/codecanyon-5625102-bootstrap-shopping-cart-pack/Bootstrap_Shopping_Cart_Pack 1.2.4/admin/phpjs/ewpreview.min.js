/**
 * Detail Preview Extension
 * @license (C)2013 e.World Technology Ltd.
 */
function ew_AddRowToTable(t){var e,a,o=jQuery,i=o(t),E=0,n=i.closest("tbody");EW_PREVIEW_SINGLE_ROW&&n.find("tr."+EW_TABLE_PREVIEW_ROW_CLASSNAME).remove(),o(t.cells).each(function(){E+=this.colSpan});var r=i.next("tr[data-rowindex!="+i.data("rowindex")+"]");return r.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)?sr:((e=n[0].insertRow(r[0]?r[0].sectionRowIndex:-1))&&(o(e).addClass(EW_TABLE_PREVIEW_ROW_CLASSNAME),a=o(e.insertCell(0)).addClass(EW_TABLE_LAST_COL_CLASSNAME).prop("colSpan",E)),e)}function ew_ShowDetails(){var t=jQuery,e=t(this),a=e.is("tr[data-rowindex]"),o=a?e:e.closest("tr[data-rowindex]"),i=o.closest("table");if(o[0]){if(o.data("preview")){var E=o.next("tr[data-rowindex!='"+o.data("rowindex")+"']");E.hasClass(EW_TABLE_PREVIEW_ROW_CLASSNAME)&&E.remove(),o.data("preview",!1).find("img."+EW_PREVIEW_IMAGE_CLASSNAME).attr("src",EW_PREVIEW_SHOW_IMAGE)}else{var n=ew_AddRowToTable(o[0]),r=t(n.cells[0]),d=o.find("[class$=_preview] div.ewPreview");r.empty(),r.append(t("#ewPreview").contents().clone()).find(".nav-tabs").append(d.find("li:has([data-toggle='tab'])").clone(!0)).find("[data-toggle='tab']").attr("data-target","#"+r.find(".tab-pane").attr("id",ew_Random()).attr("id")).first().tab("show"),(EW_PREVIEW_SINGLE_ROW?i:o).find("img."+EW_PREVIEW_IMAGE_CLASSNAME).attr("src",EW_PREVIEW_SHOW_IMAGE),o.data("preview",!0).find("img."+EW_PREVIEW_IMAGE_CLASSNAME).attr("src",EW_PREVIEW_HIDE_IMAGE)}ew_SetupTable(-1,i[0],!0)}}function ew_Detail(t,e){var a=jQuery,o=a(e),i=o.closest(".ewListOptionBody"),E=o.data("placement")||EW_PREVIEW_PLACEMENT,n=i.find(".dropdown-menu"),r=i.find(".btn-group");n.mouseenter(function(t){t.stopPropagation()}),r[0]&&("right"==E&&n.addClass("pull-right"),o=r),o.data("popover")||o.popover({html:!0,delay:{show:100,hide:250},placement:E,trigger:"hover",container:a("#ewTooltip")[0],content:EW_PREVIEW_LOADING_HTML}).on("show",function(){a(".popover.ewPreviewOverlay").hide(),o.data("popover").tip().css("opacity",0)}).on("shown",function(){var t=o.data("popover").tip().css({"min-width":"200px","max-width":"1000px"});t.find(".popover-content").html(a("#ewPreview").html()),t.find(".nav-tabs").append(i.find("li:has([data-toggle='tab'])").clone(!0)),t.find("[data-toggle='tab']").attr("data-target","#"+t.find(".tab-pane").attr("id",ew_Random()).attr("id")).data("$element",o).first().tab("show"),ew_MoveTip(o),t.fadeTo(0,1).addClass("ewPreviewOverlay")}).data("popover").tip().mouseenter(function(){clearTimeout(o.data("popover").timeout)}).mouseleave(function(){var t=o.data("popover");t.tip().html().indexOf(EW_PREVIEW_LOADING_HTML)>-1||(t.timeout=setTimeout(function(){t.hide.call(t)},t.options.delay.hide))})}function ew_MoveTip(t){var e=jQuery,a=t.data("placement")||EW_PREVIEW_PLACEMENT;if("left"==a||"right"==a){var o=e(document),i=e(document.body),E=t.data("popover").tip(),n=(E.width(),E.position()),r=t.parent();bottom=o.scrollTop()+i.outerHeight()-E.outerHeight(),r.hasClass("btn-group")&&(t=r,r=t.parent());var d=t.position();n.top=d.top+t.height()/2-E.height()/2,n.top=Math.max(o.scrollTop(),Math.min(bottom,n.top)),E.css("top",n.top+"px"),E.find("."+EW_TABLE_CLASSNAME).each(ew_SetupTable),"right"==a&&t.is(".btn-group")&&E.css("left",t.position().left+t.width());var _=E.find(".arrow");"left"==a&&(left=d.left-E.outerWidth()-_.width(),E.css("left",left));var p=d.top-n.top+t.height()/2-_.height(),l=(parseInt(E.css("border-top-left-radius"),10)||6)-parseInt(_.css("margin-top"),10),s=E.height()-l-_.height();_.css("top",Math.max(l,Math.min(p,s))+"px")}}function ew_TabShow(t){var e=jQuery,a=e(t.target),o=a.data("url"),i=a.data("table"),E=e(a.attr("data-target"));o&&E[0]&&(E.empty().html(EW_PREVIEW_LOADING_HTML),e.get(o,function(t){E.empty().html(t).append(e("div[data-table='"+i+"'][data-url='"+o+"']:first").clone()).find("table."+EW_TABLE_CLASSNAME).each(ew_SetupTable).find("a.ewTooltipLink").each(ew_Tooltip),a.data("$element")&&ew_MoveTip(a.data("$element"))}))}var EW_PREVIEW_LOADING_TEXT=ewLanguage.Phrase("Loading"),EW_PREVIEW_LOADING_IMAGE=EW_IMAGE_FOLDER+"loading.gif",EW_PREVIEW_LOADING_HTML='<img src="'+EW_PREVIEW_LOADING_IMAGE+'" alt="" style="border: 0; vertical-align: middle;"> '+EW_PREVIEW_LOADING_TEXT,EW_PREVIEW_SHOW_IMAGE=EW_IMAGE_FOLDER+"expand.gif",EW_PREVIEW_HIDE_IMAGE=EW_IMAGE_FOLDER+"collapse.gif",EW_PREVIEW_IMAGE_CLASSNAME="ewPreviewRowImage";jQuery(function(t){t("div.ewPreview").each(function(){t(this).parent().find("[data-action='view'],[data-action='list']").each(ew_Detail)}),t("img."+EW_PREVIEW_IMAGE_CLASSNAME).click(ew_ShowDetails),t("div.ewPreview [data-toggle='tab']").on("show",ew_TabShow)});